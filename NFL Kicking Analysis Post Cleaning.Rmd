---
title: "NFL Kicking Analysis (Post-Cleaning)"
author: "Josh Garzaniti"
date: "2025-07-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Packages I used:
```{r}
library(ggplot2)
library(ggdark)
library(caret)
library(tidyverse)
library(tidyr)
library(stringr)
library(xgboost)
library(randomForest)
library(ggrepel)
library(nflreadr)
library(nflplotR)
library(nflfastR)
library(mice)
library(lme4)
library(arm)
library(car)
library(effects)
library(Matrix)
library(pROC)
library(SHAPforxgboost)
library(ROSE)
library(Metrics)
library(shiny)
library(DT)
```


## Analysis
```{r}
pbp_complete = read.csv("G:/My Drive/Personal Projects/pbp_complete.csv")
```


Now we don't have to deal with missing data anymore. The next step is creating target variables. We already created on called "result" which in essence was just a make or miss variable based on if a kicker made their try attempt, but now let's make a derived variable based off of that value called probability, which is the probability of that kicker making that attempt.

P(x) we can determine a few ways:

we can group all of the attempts by distance, distance and weather, distance, weather turf condition, distance, weather, turf condition, temperature, and wind......or all of those and throw in the stadium. In that sense what we are doing is taking a historical average of how many attempts from that spot on that field in those conditions were made vs missed.....the thing we have to be smart about is not narrowing our sample size down too much to where we condense the number of tries going into the historical average. E.g say a there's only been one attempt at Lambeau field from 65 yards out, and miraculously the kicker made it.....on the next attempt from that location a kicker would be going up against a p(x) of 100% (which in theory says they should make that kick 100% of the time), yet we all know that's not factual in reality.

if we group up by:
distance
roof type
temperature
wind speed
and surface type
let's see what the empirical results of each attempt are:

```{r}
pbp_complete_grouped = pbp_complete%>%
  group_by(kick_distance, roof, temp, wind, surface)%>%
  mutate(probability_advanced = mean(result, na.rm = TRUE))%>%
  ungroup()

pbp_complete_grouped
```

A good baseline for this is to just check by distances (our probability should be dropping of drastically by distance so let's see what that distribution looks like)

```{r}
distance_vs_probability_plot = ggplot(pbp_complete_grouped, 
                                      mapping = aes(x = kick_distance,
                                                    y = probability_advanced))+
                                      geom_point()+
                                      geom_smooth()+
                                      dark_theme_minimal()+
                                      labs(title = "NFL Kick Distance vs Make Probability (advanced)", subtitle = "from 1999-2024", x = "Distance", y = "Probability")

distance_vs_probability_plot
```
What about binning vars like temp and wind?

```{r}
pbp_complete_binned = pbp_complete%>%
  mutate(
    temp_bin = cut(temp, breaks = c(-Inf, 30, 50, 70, 90, Inf), labels = c("cold", "chilly", "mild", "warm", "hot")),
    wind_bin = cut(wind, breaks = c(-Inf, 5, 10, 20, Inf), labels = c("calm", "breezy", "windy", "gusty")))%>%
  group_by(kick_distance, roof, temp_bin, wind_bin, surface)%>%
  mutate(
    group_n = n(),
    probability_advanced = ifelse(group_n >= 5, mean(result, na.rm = TRUE), NA_real_))%>%
  ungroup()%>%
  mutate(
    probability_advanced = ifelse(is.na(probability_advanced), mean(result, na.rm = TRUE), probability_advanced))
```

Visualizing this

```{r}
distance_vs_probability_plot_2 = ggplot(pbp_complete_binned, 
  aes(x = kick_distance, y = probability_advanced)) +
  geom_point(aes(size = group_n), alpha = 0.6) +
  geom_smooth() +
  geom_hline(
    yintercept = mean(pbp_complete$result, na.rm = TRUE), 
    linetype = "dashed", 
    color = "red", 
    alpha = 0.6)+
  dark_theme_minimal()+
  labs(
    title = "NFL Kick Distance vs Make Probability (advanced)", 
    subtitle = "from 1999-2024", 
    x = "Distance", 
    y = "Probability")

distance_vs_probability_plot_2
```

Facet Wrap by Roof type

```{r}
distance_vs_probability_roof = ggplot(pbp_complete_binned, 
  aes(x = kick_distance, y = probability_advanced))+
  geom_point(aes(size = group_n), alpha = 0.6)+
  geom_smooth(se = FALSE)+
  geom_hline(
    yintercept = mean(pbp_complete$result, na.rm = TRUE), 
    linetype = "dashed", color = "red", alpha = 0.6)+
  facet_wrap(~ roof)+
  dark_theme_minimal()+
  labs(
    title = "NFL Kick Distance vs Make Probability by Roof Type",
    subtitle = "From 1999–2024",
    x = "Distance",
    y = "Make Probability")

distance_vs_probability_roof
```

What about Surface type is there a relationship between distance and surface type when it comes to the probability of making kicks?

```{r}
distance_vs_probability_surface = ggplot(pbp_complete_binned, 
  aes(x = kick_distance, y = probability_advanced))+
  geom_point(aes(size = group_n), alpha = 0.6)+
  geom_smooth(se = FALSE) +
  geom_hline(
    yintercept = mean(pbp_complete$result, na.rm = TRUE), 
    linetype = "dashed", color = "red", alpha = 0.6)+
  facet_wrap(~ surface) +
  dark_theme_minimal() +
  labs(
    title = "NFL Kick Distance vs Make Probability by Field Surface",
    subtitle = "From 1999–2024",
    x = "Distance",
    y = "Make Probability")

distance_vs_probability_surface
```

#Early Analytical Questions

Here are some of the early questions I'm thinking about at this stage:

- in terms of general trends we can see that kicking accuracy has a negative relationship with distance (this makes sense and is our first check)

-kicking accuracy has strong(ger) negative relationships with distance in: closed, dome, and outdoor stadiums, but more of a logarithmic relationship with distance in open stadiums (research this)

-kicking accuracy on astroplay, astroturf, matrixturf, and sportturf surfaces appears to not have as drastic negative consequences over longer distances as field turf and grass (research what stadiums carry these types and if they're indoors or an even mix of different stadium types)

-dessograss and unknown surface types have almost a completely stable/level relationship with distance (this doesn't appear to be natural or make sense so more research is needed)


##Correlation Testing

Correlation between kick distance and make probability:
```{r}
distance_probability_cor = cor.test(pbp_complete_binned$kick_distance, pbp_complete_binned$probability_advanced)

distance_probability_cor
```
Strong Negative correlation (statistically significant) with distance and p(make).

Correlation between roof type and probability:
```{r}
roof_probability_cor = aov(probability_advanced ~ roof,data = pbp_complete_binned)

summary(roof_probability_cor)
```
This anova function tells us that roof type as a whole is significant in terms of its impact on p(make)

Going deeper:
```{r}
roof_probability_tukey = TukeyHSD(roof_probability_cor)

roof_probability_tukey
```
Results explained:
Kicks in dome stadiums are 0.65% more successful than closed stadiums
kicks in open stadiums are 1.24% more successful than closed stadiums
kicks in outdoor stadiums are 0.08% less successful than closed stadiums
kicks in outdoor stadiums are 1.50% less successful than dome stadiums
kicks in outdoor stadiums are 2.09% less successful than open stadiums

Conclusion ranking roof types for positive impact on kicking probabilities-
Dome and Open are the best
Closed are middle of the pack
Outdoor is significantly worse

```{r}
roof_prob_boxplot = ggplot(pbp_complete_binned, 
                             aes(x = roof, y = probability_advanced))+
                             geom_boxplot(fill = "skyblue", alpha = 0.7)+
                             dark_theme_minimal() +
                             labs(title = "Probability Advanced by Roof Type", 
                             x = "Roof Type", y = "Probability Advanced")

roof_prob_boxplot
```

Impact of surface type on kicking probability

I'm going to start with generic trends and then move onto brand types/names
```{r}
surface_type_probability_cor = aov(probability_advanced ~ surface_type,data = pbp_complete_binned)

summary(surface_type_probability_cor)
```
The type of surface used for fields is significant when it comes to making kicks

Tukey test surface types:
```{r}
surface_type_probability_tukey = TukeyHSD(surface_type_probability_cor)

surface_type_probability_tukey
```
Biggest significant takeaways-

Natural grass has ~1.85% less p(made) vs Artificial surfaces

Specific Brand/Surface Name tesing:
```{r}
surface_probability_cor = aov(probability_advanced ~ surface,data = pbp_complete_binned)

summary(surface_probability_cor)
```
Again we find that surface brands as a whole are significant in their relationship to kicking probability

Tukey test surface brands:
```{r}
surface_probability_tukey = TukeyHSD(surface_probability_cor)

surface_probability_tukey
```
Takeaways-

Natural Grass is significant worse than MatrixTurf, SportTurf, Dessograss, and Astroplay.

Dessograss, MatrixTurf, Astroplay are consistently beating other types.

FieldTurf and Astroturf have below average kicking probabilities.

Unknown brands/surface types are slightly worse than Astroplay and borderline worse than MatrixTurf, but not statistically different from Grass or SportTurf.

##Going back to probability and distance

remember in those charts earlier how I was seeing probability fit more of a logarithmic equation around distance rather than an exponential one?

Let's take a look at edge/fringe cases to see if longer kicks really do fit that pattern or what's really going on there.

```{r}
long_distance = pbp_complete_grouped%>%
  filter(kick_distance >= 50)
```

There are 3556 known attempts from 1999 onwards where a kick has been tried from 50+ yards.

What's the average make probability of those kicks as a whole:
```{r}
long_distance_average = mean(long_distance$probability_advanced)

long_distance_average
```
We can see that roughly 61.70% of kicks attempted from 50+ yards are made.

Broken down by yardage:
```{r}
long_distance_average_by_yard = long_distance%>%
  group_by(kick_distance)%>%
  summarise(average_probability = mean(probability_advanced),
            tries = n())

head(long_distance_average_by_yard, 10)
```

Plotting this out:
```{r}
long_distance_average_by_yard_plot = ggplot(long_distance_average_by_yard, 
                                            mapping = aes(x = kick_distance, 
                                                          y = average_probability))+
                                            geom_point(aes(size = tries))+
                                            geom_smooth()+
                                            dark_theme_minimal()+
                                            labs(title = "Probability of successful NFL field goal tries >= 50 yards", 
                                            subtitle = "since 1999", 
                                            x = "Yardage",
                                            y = "Probability")

long_distance_average_by_yard_plot
```

This makes much more sense so those fringe cases really aren't amounting to "better" kicking at longer distances....they're just minimal tries which should be fitting more of an exponential function over distance. 

So as a whole p(making a field goal over distance with respect to the number of tries (and not binning field goals) looks like this):
```{r}
distance_summary = pbp_complete_grouped%>%
  group_by(kick_distance)%>%
  summarise(
    average_probability = mean(probability_advanced, na.rm = TRUE),
    tries = n())


distance_vs_probability_plot_3 = ggplot(distance_summary, 
                                      aes(x = kick_distance,
                                          y = average_probability,
                                          size = tries))+
                                          geom_point(alpha = 0.6)+
                                          geom_smooth(se = FALSE)+
                                          dark_theme_minimal()+
                                          labs(title = "NFL Kick Distance vs Make Probability (Advanced)",
                                          subtitle = "from 1999–2024",
                                          x = "Distance (yards)",
                                          y = "Probability of make",
                                          size = "Attempts")

distance_vs_probability_plot_3
```

##Mixed Effect Modeling before scaling

One thing I want to do in this analysis is break down how how different players, teams, stadiums, roof types, and surfaces impact the expected kicker probabilities and make probability above expected.

Let's start off with a simple me model on kickers as a whole

```{r}
kicker_mixed_model = glmer(result ~ kick_distance + temp + roof + wind + surface + (1|kicker_player_name), 
                          data = pbp_complete, 
                          family = binomial)

summary(kicker_mixed_model)
```
Takeaways:
- std being 0.4489 shows that some kickers are better/worse than average
- +/- 0.45 log-odds translates to +/-11 percentage points in make probability
-temperature slightly increases your odds of making a kick
-wind slightly decreases your odds of making a kick
-none of the roof types or surface types are significant in terms of p(making a kick)


##Scaling

Scaling to a mean of 0 and a SD of 1
```{r}
pbp_complete$kick_distance_scaled = scale(pbp_complete$kick_distance)
pbp_complete$temp_scaled = scale(pbp_complete$temp)
pbp_complete$wind_scaled = scale(pbp_complete$wind)
```

##Mixed Effect Model with Scaling

```{r}
kicker_mixed_model = glmer(result ~ kick_distance_scaled + temp_scaled + roof + wind_scaled + surface + (1|kicker_player_name), 
                          data = pbp_complete, 
                          family = binomial, control = glmerControl(optimizer = "bobyqa"))

summary(kicker_mixed_model)
```
Takeaways after scaling:
-your odds of making a kick decrease by ~71.32% for each standard deviation (roughly 9 yards) increase from the average distance 
-odds actually increase by ~12.04% for every SD increase in temperature (~20 degrees)
-odds decrease ~10.17% for each SD increase in wind speed (~5.5mph)

##What are kicker-specific random effects?
```{r}
kicker_effects = ranef(kicker_mixed_model, condVar = TRUE)$kicker_player_name

kicker_effects = kicker_effects%>%
  arrange(desc(`(Intercept)`))

head(kicker_effects, 10)

tail(kicker_effects, 10)
```

The intercepts we see here display the impacts or effects individual kickers have on kick probability given roof type, temperature, wind speed, surface type and distance. So given all those variables guess who is head and shoulders above the rest of the league....Justin Tucker by a wide margin. Anything positive means above average and anything negative is under average

##Plotting Kicker Effects out

Lets filter down to current NFL kickers and get a gauge of who is performing above league average in terms of kick probability for all of these factors taken into consideration.


```{r}
random_effects_df = as.data.frame(kicker_effects)

random_effects_df$kicker = row.names(kicker_effects)
```


```{r}
standard_error_kicker = se.ranef(kicker_mixed_model)$kicker_player_name[,1]

random_effects_df$standard_error = standard_error_kicker

random_effects_df = random_effects_df%>%
  mutate(lower = `(Intercept)` - 1.96*standard_error,
         upper = `(Intercept)` + 1.96*standard_error)

```

Filtering down to current players
```{r}
random_effects_df = random_effects_df%>%
  filter(kicker %in% c("J.Bates", "J.Tucker", "C.Boswell", "C.Dicker", "B.Aubrey",
                       "C.McLaughlin", "J.Elliott", "T.Bass", "J.Sanders", "H.Butker",
                       "T.Loop", "K.Fairbairn", "C.Santos", "J.Karty", "M.Gay", "W.Lutz",
                       "E.McPherson", "D.Carlson", "B.McManus", "J.Myers", "W.Reichard",
                       "Y.Koo", "Z.Gonzalez", "J.Moody", "C.Little", "A.Borregales", 
                       "C.Ryland", "G.Gano", "D.Hopkins", "M.Wright", "S.Shrader", 
                       "B.Grupe", "J.Slye", "J.McAtamney", "J.Parker Romo", "C.Davis",
                       "A.Carlson", "G.Zuerlein", "N.Folk", "G.Joseph", "E.Pineiro", 
                       "A.Seibert", "M.Prater", "B.Narveson", "L.Havrisik", "C.York",
                       "T.Brown", "C.Dunn", "R.Bullock", "B.Maher", "M.Ammendola", 
                       "N.Sciba", "J.Garibay", "R.Patterson", "J. McCourt", "C.Shudak", "M.Badgley"))
```



Plot
```{r}
Kicker_Random_Effects_plot1 = ggplot(random_effects_df, aes(x = reorder(kicker, `(Intercept)`), y = `(Intercept)`))+
  geom_point()+
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2)+
  coord_flip()+
  geom_hline(yintercept = 0, linetype = "dashed")+
  dark_theme_minimal()+
  labs(title = "Current NFL Kicker-Specific Random Effects with 95% CI",
       y = "Random Intercept (Effect on Log-Odds)",
       x = "Kicker") 

Kicker_Random_Effects_plot1

```
Looking at the plot in terms of P(making a kick)
```{r}
probability_function = function(logit){
  plogis(logit)
}


random_effects_probability_df = random_effects_df%>%
  mutate(probability = probability_function(`(Intercept)`))%>%
  arrange(desc(probability))

head(random_effects_probability_df, 10)
```

Plotting
```{r}
mean_prob = mean(random_effects_probability_df$probability, na.rm = TRUE)

Kicker_Random_Effects_prob = ggplot(random_effects_probability_df, aes(x = reorder(kicker, probability), y = probability)) +
  geom_hline(yintercept = mean_prob, linetype = "dashed") +
  geom_point() +
  coord_flip() +
  dark_theme_minimal() +
  labs(title = "Current NFL Kicker-Specific Random Effects", 
       subtitle = "In terms of probability of making a kick",
       y = "Probability",
       x = "Kicker")

Kicker_Random_Effects_prob
```

Highlighting specific players

```{r}
highlighted_kicker = "W.Lutz" #Just change this to the kicker you want to study

random_effects_probability_df = random_effects_probability_df%>%
  mutate(highlight = ifelse(kicker == highlighted_kicker, "Highlighted", "Other"))

mean_prob = mean(random_effects_probability_df$probability, na.rm = TRUE)

ggplot(random_effects_probability_df, aes(x = reorder(kicker, probability), 
                                          y = probability, 
                                          fill = highlight))+
  geom_col(show.legend = FALSE)+
  geom_hline(yintercept = mean_prob, linetype = "dashed")+
  coord_flip()+
  scale_fill_manual(values = c("Highlighted" = "orange", "Other" = "gray70"))+
  dark_theme_minimal()+
  labs(title = "Kicker-Specific Random Effects", 
       subtitle = "In terms of probability of making a kick",
       y = "Probability",
       x = "Kicker")

```

##Modeling with Surface Type instead of Surface
I want to try and run another model but this time with surface (artificial or real), instead of the specific brand of surface type used to capture general trends.

```{r}
kicker_mixed_model2 = glmer(result ~ kick_distance_scaled + temp_scaled + roof + wind_scaled + surface_type + (1|kicker_player_name), 
                          data = pbp_complete, 
                          family = binomial, control = glmerControl(optimizer = "bobyqa"))

summary(kicker_mixed_model2)
```
-according to this model, natural grass has a slightly more negative impact on make probability vs artificial surfaces, but it's not statistically significant.

##Next Modeling Steps

Add game_seconds_remaining, score differential, quarter.

Add distance * wind interaction.

Consider random slope for distance per kicker.

Check AIC / model fit improvements.

Check for multicollinearity (VIF) after adding interactions.

Mutating to create a score differential variable and a score differential type variable
```{r}
pbp_complete = pbp_complete%>%
  mutate(score_differential = abs(total_home_score - total_away_score),
         score_differential_type = case_when(
           score_differential == 0 ~ "Tied",
           score_differential <= 7 ~ "One Possession",
           score_differential > 7 & score_differential <= 14 ~ "Close",
           score_differential > 14 ~ "Blowout"))

pbp_complete$score_differential_type = factor(pbp_complete$score_differential_type,
           levels = c("Tied", "One Possession", "Close", "Blowout"))

pbp_complete = pbp_complete%>%
  mutate(score_differential = as.numeric(score_differential))
  
```


Modeling with Score Differential
```{r}
kicker_mixed_model3 = glmer(result ~ kick_distance_scaled + temp_scaled + roof + wind_scaled + surface_type + score_differential +(1|kicker_player_name), 
                          data = pbp_complete, 
                          family = binomial, control = glmerControl(optimizer = "bobyqa"))

summary(kicker_mixed_model3)
```

We can see that score differential is very significant in terms of individual kickers making their kicks. In fact for each point increase in the score differential, kickers increase their odds of making an individual kick by 2.06%


Plotting this out
```{r}

prob_by_score_diff = pbp_complete%>%
  group_by(score_differential)%>%
  summarise(prob_make = mean(result))

score_differential_make_plot = ggplot(prob_by_score_diff, aes(x = score_differential, y = prob_make)) +
  geom_point() +
  geom_smooth(method = "glm", method.args = list(family = "binomial")) +
  dark_theme_minimal() +
  labs(title = "Impact of Score Differential on NFL Kick Probability",
       subtitle = "1999-2024",
       x = "Score Differential",
       y = "Probability of Make")

score_differential_make_plot
```





Quick Multi-collinearity check
```{r}
kicker_glm_fixed = glm(result ~ kick_distance_scaled + temp_scaled + roof + wind_scaled + surface_type + score_differential,
                       data = pbp_complete,
                       family = binomial)
vif(kicker_glm_fixed)
```

All of my VIF levels are under 2 which is great to see in terms of having variables in my model

Next model
```{r}
kicker_mixed_model4 = glmer(result ~ kick_distance_scaled + temp_scaled + roof + wind_scaled + surface_type + score_differential_type +(1|kicker_player_name), 
                          data = pbp_complete, 
                          family = binomial, control = glmerControl(optimizer = "bobyqa"))

summary(kicker_mixed_model4)
```
Last Mixed Effects Model
```{r}
kicker_mixed_model5 = glmer(result ~ kick_distance_scaled + 
                              temp_scaled + 
                              roof + 
                              wind_scaled + 
                              surface_type + 
                              score_differential_type + 
                              quarter_seconds_remaining +
                              half_seconds_remaining + 
                              game_seconds_remaining + 
                              (1|kicker_player_name), 
                          data = pbp_complete, 
                          family = binomial, control = glmerControl(optimizer = "bobyqa"))

summary(kicker_mixed_model5)
```

Here we can see that time remaining in a quarter, half, and game doesn't have a significant impact on a kicker's make probability.

Visualzing effects
```{r}
score_diff_effect = Effect("score_differential_type", kicker_mixed_model4)

kick_dist_effect = Effect("kick_distance_scaled", kicker_mixed_model4)

temp_effect = Effect("temp_scaled", kicker_mixed_model4)

roof_effect = Effect("roof", kicker_mixed_model4)

wind_effect = Effect("wind_scaled", kicker_mixed_model4)

surface_type_effect = Effect("surface_type", kicker_mixed_model4)

```

score differential
```{r}
plot(score_diff_effect)
```

distance
```{r}
plot(kick_dist_effect)
```

temperature
```{r}
plot(temp_effect)
```

roof types
```{r}
plot(roof_effect)
```

wind speed
```{r}
plot(wind_effect)
```

surface type
```{r}
plot(surface_type_effect)
```

save pbp_complete_grouped and final model
```{r}
write.csv(pbp_complete_grouped, "G:/My Drive/Personal Projects/pbp_complete_grouped.csv", row.names = FALSE)
```

##Answering the Question:How do we rank kickers in the NFL Dynamically and who are the best kickers in the league right now? (For both Field Goals and XP's)

creating makes above expected variable based on how the kicker historically performed and what the probability of each kick was statistically
```{r}
ranked_kickers = pbp_complete_grouped%>%
  mutate(makes_above_expected = result - probability_advanced)
```

Ranking kickers
```{r}
ranked_kickers_total = ranked_kickers%>%
  group_by(kicker_player_name)%>%
  summarise(kicks_attempted = n(),
            kicks_made = sum(result),
            percentage = (kicks_made / kicks_attempted),
            total_above_expected = sum(makes_above_expected),
            average_above_expected = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(total_above_expected))

head(ranked_kickers_total, 10)
```

Ranked kickers by average above expected
```{r}
ranked_kickers_average = ranked_kickers%>%
  group_by(kicker_player_name)%>%
  summarise(kicks_attempted = n(),
            kicks_made = sum(result),
            percentage = (kicks_made / kicks_attempted),
            total_above_expected = sum(makes_above_expected),
            average_above_expected = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(average_above_expected))

head(ranked_kickers_average, 10)

```

Historically these are our best performers on kicking performances above expected probabilities of each kick being made

##Looking at current players only:
```{r}
ranked_kickers_total_current = ranked_kickers%>%
  filter(kicker_player_name %in% c("J.Bates", "J.Tucker", "C.Boswell", "C.Dicker", "B.Aubrey", "C.McLaughlin", "J.Elliott", "T.Bass", "J.Sanders", "H.Butker", "T.Loop", "K.Fairbairn", "C.Santos", "J.Karty", "M.Gay", "W.Lutz", "E.McPherson", "D.Carlson", "B.McManus", "J.Myers", "W.Reichard", "Y.Koo", "Z.Gonzalez", "J.Moody", "C.Little", "A.Borregales", "C.Ryland", "G.Gano", "D.Hopkins", "M.Wright", "S.Shrader", "B.Grupe", "J.Slye", "J.McAtamney", "J.Parker Romo", "C.Davis", "A.Carlson", "G.Zuerlein", "N.Folk", "G.Joseph", "E.Pineiro", "A.Seibert", "M.Prater", "B.Narveson", "L.Havrisik", "C.York", "T.Brown", "C.Dunn", "R.Bullock", "B.Maher", "M.Ammendola", "N.Sciba", "J.Garibay", "R.Patterson", "J. McCourt", "C.Shudak", "M.Badgley"))%>%
  group_by(kicker_player_name)%>%
  summarise(kicks_attempted = n(),
            kicks_made = sum(result),
            percentage = (kicks_made / kicks_attempted),
            total_above_expected = sum(makes_above_expected),
            average_above_expected = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(total_above_expected))

head(ranked_kickers_total_current, 10)
```

current players but for percentage above expected
```{r}
ranked_kickers_average_current = ranked_kickers%>%
  group_by(kicker_player_name)%>%
  summarise(kicks_attempted = n(),
            kicks_made = sum(result),
            percentage = (kicks_made / kicks_attempted),
            total_above_expected = sum(makes_above_expected),
            average_above_expected = mean(makes_above_expected),
            .groups = 'drop')%>%
  filter(kicker_player_name %in% c("J.Bates", "J.Tucker", "C.Boswell", "C.Dicker", "B.Aubrey", "C.McLaughlin", "J.Elliott", "T.Bass", "J.Sanders", "H.Butker", "T.Loop", "K.Fairbairn", "C.Santos", "J.Karty", "M.Gay", "W.Lutz", "E.McPherson", "D.Carlson", "B.McManus", "J.Myers", "W.Reichard", "Y.Koo", "Z.Gonzalez", "J.Moody", "C.Little", "A.Borregales", "C.Ryland", "G.Gano", "D.Hopkins", "M.Wright", "S.Shrader", "B.Grupe", "J.Slye", "J.McAtamney", "J.Parker Romo", "C.Davis", "A.Carlson", "G.Zuerlein", "N.Folk", "G.Joseph", "E.Pineiro", "A.Seibert", "M.Prater", "B.Narveson", "L.Havrisik", "C.York", "T.Brown", "C.Dunn", "R.Bullock", "B.Maher", "M.Ammendola", "N.Sciba", "J.Garibay", "R.Patterson", "J. McCourt", "C.Shudak", "M.Badgley"))%>%
  arrange(desc(average_above_expected))%>%
  mutate(AMoE_current_rank = row_number())

head(ranked_kickers_average_current, 10)
```

Plotting these
```{r}
mean_total_above_expected = mean(ranked_kickers_total_current$total_above_expected)


current_kickers_kicks_above_exp_plot = ggplot(ranked_kickers_total_current, 
  mapping = aes(x = kicker_player_name, 
  y = total_above_expected,
  size = kicks_attempted))+
  geom_point()+
  geom_hline(yintercept = mean_total_above_expected, 
             linetype = "dashed", color = "red")+
  dark_theme_minimal()+
  theme(axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    panel.grid = element_blank())+
  geom_text_repel(aes(label = kicker_player_name), 
                  nudge_y = -0.5,
                  direction = "y",
                  segment.size = 0.2, 
                  size = 3)+
  labs(title = "Total Kicks Made Above Expected", 
       subtitle = "current NFL kickers",
       x = "Player",
       y = "Kicks Above Expected")

current_kickers_kicks_above_exp_plot
```

Now doing it for % above expected
```{r}
mean_avg_above_expected = mean(ranked_kickers_average_current$average_above_expected)

current_kickers_avg_above_exp_plot = ggplot(ranked_kickers_average_current, 
  mapping = aes(x = kicker_player_name,                                                     y = average_above_expected,
  size = kicks_attempted))+
  geom_point()+
  geom_hline(yintercept = mean_avg_above_expected, 
             linetype = "dashed", color = "red")+
  geom_text_repel(aes(label = kicker_player_name), 
                  nudge_y = -0.005,
                  direction = "y",
                  segment.size = 0.2, 
                  size = 3)+
  dark_theme_minimal()+
  theme(axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    panel.grid = element_blank())+
  labs(title = "Average Kicks Made Above Expected", 
       subtitle = "Current NFL Kickers",
       x = "",
       y = "Average KoE")

current_kickers_avg_above_exp_plot

```

##Field Goals only

We know field goals are more important because of the weight they naturally carry in terms of points, so let's filter attempts down to just those to see if anything is different.
```{r}
 ranked_kickers_fgs = ranked_kickers%>%
  filter(field_goal_attempt == 1)

ranked_kickers_fg_total = ranked_kickers_fgs%>%
  group_by(kicker_player_name)%>%
  summarise(fgs_attempted = n(),
            fgs_made = sum(result),
            percentage = (fgs_made / fgs_attempted),
            total_above_expected = sum(makes_above_expected),
            average_above_expected = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(total_above_expected))

head(ranked_kickers_fg_total, 10)
```

historical average field goals above expected
```{r}
ranked_kickers_fg_avg = ranked_kickers_fgs%>%
  group_by(kicker_player_name)%>%
  summarise(fgs_attempted = n(),
            fgs_made = sum(result),
            percentage = (fgs_made / fgs_attempted),
            total_above_expected = sum(makes_above_expected),
            average_above_expected = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(average_above_expected))

head(ranked_kickers_fg_avg, 10)
```

Current Kickers Total:
```{r}
ranked_kickers_fg_current = ranked_kickers_fgs%>%
  filter(kicker_player_name %in% c("J.Bates", "J.Tucker", "C.Boswell", "C.Dicker", "B.Aubrey", "C.McLaughlin", "J.Elliott", "T.Bass", "J.Sanders", "H.Butker", "T.Loop", "K.Fairbairn", "C.Santos", "J.Karty", "M.Gay", "W.Lutz", "E.McPherson", "D.Carlson", "B.McManus", "J.Myers", "W.Reichard", "Y.Koo", "Z.Gonzalez", "J.Moody", "C.Little", "A.Borregales", "C.Ryland", "G.Gano", "D.Hopkins", "M.Wright", "S.Shrader", "B.Grupe", "J.Slye", "J.McAtamney", "J.Parker Romo", "C.Davis", "A.Carlson", "G.Zuerlein", "N.Folk", "G.Joseph", "E.Pineiro", "A.Seibert", "M.Prater", "B.Narveson", "L.Havrisik", "C.York", "T.Brown", "C.Dunn", "R.Bullock", "B.Maher", "M.Ammendola", "N.Sciba", "J.Garibay", "R.Patterson", "J. McCourt", "C.Shudak", "M.Badgley"))%>%
  group_by(kicker_player_name)%>%
  summarise(fgs_attempted = n(),
            fgs_made = sum(result),
            percentage = (fgs_made / fgs_attempted),
            total_above_expected = sum(makes_above_expected),
            average_above_expected = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(average_above_expected))

head(ranked_kickers_fg_current, 10)

```

Current average fg's
```{r}
ranked_kickers_fg_current_avg = ranked_kickers_fgs%>%
  filter(kicker_player_name %in% c("J.Bates", "J.Tucker", "C.Boswell", "C.Dicker", "B.Aubrey", "C.McLaughlin", "J.Elliott", "T.Bass", "J.Sanders", "H.Butker", "T.Loop", "K.Fairbairn", "C.Santos", "J.Karty", "M.Gay", "W.Lutz", "E.McPherson", "D.Carlson", "B.McManus", "J.Myers", "W.Reichard", "Y.Koo", "Z.Gonzalez", "J.Moody", "C.Little", "A.Borregales", "C.Ryland", "G.Gano", "D.Hopkins", "M.Wright", "S.Shrader", "B.Grupe", "J.Slye", "J.McAtamney", "J.Parker Romo", "C.Davis", "A.Carlson", "G.Zuerlein", "N.Folk", "G.Joseph", "E.Pineiro", "A.Seibert", "M.Prater", "B.Narveson", "L.Havrisik", "C.York", "T.Brown", "C.Dunn", "R.Bullock", "B.Maher", "M.Ammendola", "N.Sciba", "J.Garibay", "R.Patterson", "J. McCourt", "C.Shudak", "M.Badgley"))%>%
  group_by(kicker_player_name)%>%
  summarise(fgs_attempted = n(),
            fgs_made = sum(result),
            percentage = (fgs_made / fgs_attempted),
            total_above_expected = sum(makes_above_expected),
            average_above_expected = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(average_above_expected))%>%
  mutate(AMoE_FG_current_rank = row_number())

head(ranked_kickers_fg_current_avg, 10)
```

Plotting Field Goal Kicking Efficiency for Current Kickers
```{r}
mean_fg_above_expected = mean(ranked_kickers_fg_current$total_above_expected)


current_kickers_kicks_above_exp_plot = ggplot(ranked_kickers_fg_current, 
  mapping = aes(x = kicker_player_name, 
  y = total_above_expected,
  size = fgs_attempted))+
  geom_point()+
  geom_hline(yintercept = mean_fg_above_expected, 
             linetype = "dashed", color = "red")+
  dark_theme_minimal()+
  theme(axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    panel.grid = element_blank())+
  geom_text_repel(aes(label = kicker_player_name), 
                  nudge_y = -0.5,
                  direction = "y",
                  segment.size = 0.2, 
                  size = 3)+
  labs(title = "Total Field Goals Made Above Expected", 
       subtitle = "current NFL kickers",
       x = "Player",
       y = "FG's Above Expected")

current_kickers_kicks_above_exp_plot
```

Average field goals made above expected for Current kickers
```{r}
mean_avg_fg_above_expected = mean(ranked_kickers_fg_current_avg$average_above_expected)


current_kickers_avg_kicks_above_exp_plot = ggplot(ranked_kickers_fg_current_avg, 
  mapping = aes(x = kicker_player_name, 
  y = average_above_expected,
  size = fgs_attempted))+
  geom_point()+
  geom_hline(yintercept = mean_avg_fg_above_expected, 
             linetype = "dashed", color = "red")+
  dark_theme_minimal()+
  theme(axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    panel.grid = element_blank())+
  geom_text_repel(aes(label = kicker_player_name), 
                  nudge_y = -0.005,
                  direction = "y",
                  segment.size = 0.2, 
                  size = 3)+
  labs(title = "Average Field Goals Made Above Expected", 
       subtitle = "current NFL kickers",
       x = "Player",
       y = "Average FGoE")

current_kickers_avg_kicks_above_exp_plot
```

##Who are the best kickers in long distance situations (50+)?
```{r}
 ranked_kickers_long = ranked_kickers%>%
  filter(kick_distance >= 50)

ranked_kickers_long_total = ranked_kickers_long%>%
  group_by(kicker_player_name)%>%
  summarise(fgs_attempted = n(),
            fgs_made = sum(result),
            percentage = (fgs_made / fgs_attempted),
            total_above_expected = sum(makes_above_expected),
            average_above_expected = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(total_above_expected))

head(ranked_kickers_long_total, 10)
```
 Matt Prater actually added the most total kicks (field goals) above expected in terms of attempts over 50+ yards from a historical perspective

Average kicks made above expected over 50+
```{r}
ranked_kickers_long_avg = ranked_kickers_long%>%
  group_by(kicker_player_name)%>%
  summarise(fgs_attempted = n(),
            fgs_made = sum(result),
            percentage = (fgs_made / fgs_attempted),
            total_above_expected = sum(makes_above_expected),
            average_above_expected = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(average_above_expected))

head(ranked_kickers_long_avg, 10)
```
You can already see some names of current players starting to make their appearance: Jake Bates and Brendan Aubrey creating value above 50 yards on a play by play basis.


Current players total kicks above expected 50+
```{r}
ranked_kickers_long_current = ranked_kickers_long%>%
  filter(kicker_player_name %in% c("J.Bates", "J.Tucker", "C.Boswell", "C.Dicker", "B.Aubrey", "C.McLaughlin", "J.Elliott", "T.Bass", "J.Sanders", "H.Butker", "T.Loop", "K.Fairbairn", "C.Santos", "J.Karty", "M.Gay", "W.Lutz", "E.McPherson", "D.Carlson", "B.McManus", "J.Myers", "W.Reichard", "Y.Koo", "Z.Gonzalez", "J.Moody", "C.Little", "A.Borregales", "C.Ryland", "G.Gano", "D.Hopkins", "M.Wright", "S.Shrader", "B.Grupe", "J.Slye", "J.McAtamney", "J.Parker Romo", "C.Davis", "A.Carlson", "G.Zuerlein", "N.Folk", "G.Joseph", "E.Pineiro", "A.Seibert", "M.Prater", "B.Narveson", "L.Havrisik", "C.York", "T.Brown", "C.Dunn", "R.Bullock", "B.Maher", "M.Ammendola", "N.Sciba", "J.Garibay", "R.Patterson", "J. McCourt", "C.Shudak", "M.Badgley"))%>%
  group_by(kicker_player_name)%>%
  summarise(fgs_attempted = n(),
            fgs_made = sum(result),
            percentage = (fgs_made / fgs_attempted),
            total_above_expected = sum(makes_above_expected),
            average_above_expected = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(total_above_expected))

head(ranked_kickers_long_current, 10)
```

Here are your leaders in terms of total career value in kicking above expectations on 50+ yard plays

Matt Prater
Justin Tucker
Chris Boswell
Nick Folk
Chase McGlaughlin
Younghoe Koo
Brendan Aubrey
Evan Mcphearson
Kiami Fairbairn
Jason Myers

Play by play value 50+ current:
```{r}
ranked_kickers_long_current_avg = ranked_kickers_long%>%
  filter(kicker_player_name %in% c("J.Bates", "J.Tucker", "C.Boswell", "C.Dicker", "B.Aubrey", "C.McLaughlin", "J.Elliott", "T.Bass", "J.Sanders", "H.Butker", "T.Loop", "K.Fairbairn", "C.Santos", "J.Karty", "M.Gay", "W.Lutz", "E.McPherson", "D.Carlson", "B.McManus", "J.Myers", "W.Reichard", "Y.Koo", "Z.Gonzalez", "J.Moody", "C.Little", "A.Borregales", "C.Ryland", "G.Gano", "D.Hopkins", "M.Wright", "S.Shrader", "B.Grupe", "J.Slye", "J.McAtamney", "J.Parker Romo", "C.Davis", "A.Carlson", "G.Zuerlein", "N.Folk", "G.Joseph", "E.Pineiro", "A.Seibert", "M.Prater", "B.Narveson", "L.Havrisik", "C.York", "T.Brown", "C.Dunn", "R.Bullock", "B.Maher", "M.Ammendola", "N.Sciba", "J.Garibay", "R.Patterson", "J. McCourt", "C.Shudak", "M.Badgley"))%>%
  group_by(kicker_player_name)%>%
  summarise(fgs_attempted = n(),
            fgs_made = sum(result),
            percentage = (fgs_made / fgs_attempted),
            total_above_expected = sum(makes_above_expected),
            average_above_expected = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(average_above_expected))%>%
  mutate(long_current_rank = row_number())

head(ranked_kickers_long_current_avg, 10)
```

On a Play by Play basis Jake Bates and Brendan Aubrey are crushing it for kicks past 50 yards

Plots total 50+
```{r}
mean_fg_above_expected_long = mean(ranked_kickers_long_current$total_above_expected)


current_kickers_kicks_above_exp_long_plot = ggplot(ranked_kickers_long_current, 
  mapping = aes(x = kicker_player_name, 
  y = total_above_expected,
  size = fgs_attempted))+
  geom_point()+
  geom_hline(yintercept = mean_fg_above_expected_long, 
             linetype = "dashed", color = "red")+
  dark_theme_minimal()+
  theme(axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    panel.grid = element_blank())+
  geom_text_repel(aes(label = kicker_player_name), 
                  nudge_y = -0.5,
                  direction = "y",
                  segment.size = 0.2, 
                  size = 3)+
  labs(title = "Career Total Field Goals Made Above Expected", 
       subtitle = "current NFL kickers for kicks 50 yards or longer",
       x = "Player",
       y = "FG's Above Expected")

current_kickers_kicks_above_exp_long_plot
```

play by play 50+ plot
```{r}
mean_avg_fg_above_expected_long = mean(ranked_kickers_long_current_avg$average_above_expected)


current_kickers_avg_kicks_above_exp_long_plot = ggplot(ranked_kickers_long_current_avg, 
  mapping = aes(x = kicker_player_name, 
  y = average_above_expected,
  size = fgs_attempted))+
  geom_point()+
  geom_hline(yintercept = mean_avg_fg_above_expected_long, 
             linetype = "dashed", color = "red")+
  dark_theme_minimal()+
  theme(axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    panel.grid = element_blank())+
  geom_text_repel(aes(label = kicker_player_name), 
                  nudge_y = -0.005,
                  direction = "y",
                  segment.size = 0.2, 
                  size = 3)+
  labs(title = "Average Field Goals Made Above Expected", 
       subtitle = "current NFL kickers for kicks 50+ yards or greater",
       x = "Player",
       y = "Average FGoE")

current_kickers_avg_kicks_above_exp_long_plot
```

Jake Bates has a small sample size right now but look how well he's performing on a play by play basis compared to the rest of the field.

##Who is the best clutch kicker?
I'm defining clutch as qualifying via one of these 3 scenarios:

4th Quarter or Overtime

Game Tying or Go-Ahead Kicks (Win Probability impact)

Close Game Situations (Score Differential ≤ 3 points)

clutch binary variable
```{r}
ranked_kickers_clutch = ranked_kickers%>%
  mutate(score_diff = abs(total_home_score - total_away_score),
         is_clutch = ifelse(qtr >= 4 & score_diff <= 3 & abs(wpa) >= 0.01, 1, 0)) 
```

clutch df
```{r}
clutch_kicker_stats = ranked_kickers_clutch%>%
  filter(is_clutch == 1)%>%
  group_by(kicker_player_name)%>%
  summarise(clutch_attempts = n(),
            clutch_makes = sum(result),
            clutch_percentage = clutch_makes / clutch_attempts,
            clutch_total_above_exp = sum(makes_above_expected),
            clutch_avg_above_exp = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(clutch_avg_above_exp))

head(clutch_kicker_stats, 10)
```

Let me try to break this down in a few ways:

according to "clutch" situations

Adam Vinatieri has the most clutch makes overall

A lot of kickers have the best clutch percentage (limited reps)

Matt Prater has made the most field goals above expected in clutch situations.

Jake Bates, Aubrey, Dicker, Wright, and Reichard get in on a play by play basis (again limited reps)

Clutch with reps:
```{r}
clutch_kicker_stats_with_reps = ranked_kickers_clutch%>%
  filter(is_clutch == 1)%>%
  group_by(kicker_player_name)%>%
  summarise(clutch_attempts = n(),
            clutch_makes = sum(result),
            clutch_percentage = clutch_makes / clutch_attempts,
            clutch_total_above_exp = sum(makes_above_expected),
            clutch_avg_above_exp = mean(makes_above_expected),
            .groups = 'drop')%>%
            filter(clutch_attempts >= 50)%>% ##You can modify this to whichever threshold
  arrange(desc(clutch_avg_above_exp))

head(clutch_kicker_stats_with_reps, 10)
```

Current clutch kickers ranked::
```{r}
clutch_kicker_current = ranked_kickers_clutch%>%
  filter(is_clutch == 1, kicker_player_name %in% c("J.Bates", "J.Tucker", "C.Boswell", "C.Dicker", "B.Aubrey", "C.McLaughlin", "J.Elliott", "T.Bass", "J.Sanders", "H.Butker", "T.Loop", "K.Fairbairn", "C.Santos", "J.Karty", "M.Gay", "W.Lutz", "E.McPherson", "D.Carlson", "B.McManus", "J.Myers", "W.Reichard", "Y.Koo", "Z.Gonzalez", "J.Moody", "C.Little", "A.Borregales", "C.Ryland", "G.Gano", "D.Hopkins", "M.Wright", "S.Shrader", "B.Grupe", "J.Slye", "J.McAtamney", "J.Parker Romo", "C.Davis", "A.Carlson", "G.Zuerlein", "N.Folk", "G.Joseph", "E.Pineiro", "A.Seibert", "M.Prater", "B.Narveson", "L.Havrisik", "C.York", "T.Brown", "C.Dunn", "R.Bullock", "B.Maher", "M.Ammendola", "N.Sciba", "J.Garibay", "R.Patterson", "J. McCourt", "C.Shudak", "M.Badgley"))%>%
  group_by(kicker_player_name)%>%
  summarise(clutch_attempts = n(),
            clutch_makes = sum(result),
            clutch_percentage = clutch_makes / clutch_attempts,
            clutch_total_above_exp = sum(makes_above_expected),
            clutch_avg_above_exp = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(clutch_avg_above_exp))%>%
  mutate(clutch_current_rank = row_number())

head(clutch_kicker_current, 10)
```

##Who is the best kicker in the worst weather conditions?
I'm defining bad weather situations as applying to one of these 2 conditions:

Windy Conditions (wind ≥ 10 mph)

Cold Weather (temp ≤ 40°F)


wind conditions:
```{r}
windy_kicks = ranked_kickers%>%
  filter(wind >= 10)%>%
  group_by(kicker_player_name)%>%
  summarise(windy_attempts = n(),
            windy_makes = sum(result),
            windy_percentage = windy_makes / windy_attempts,
            windy_total_above_exp = sum(makes_above_expected),
            windy_avg_above_exp = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(windy_total_above_exp))

head(windy_kicks, 10)
```

cold conditions:
```{r}
cold_kicks = ranked_kickers%>%
  filter(temp <= 40)%>%
  group_by(kicker_player_name)%>%
  summarise(cold_attempts = n(),
            cold_makes = sum(result),
            cold_percentage = cold_makes / cold_attempts,
            cold_total_above_exp = sum(makes_above_expected),
            cold_avg_above_exp = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(cold_total_above_exp))

head(cold_kicks, 10)
```

best current windy kickers:
```{r}
windy_kicks_current = ranked_kickers%>%
  filter(wind >= 10,
         kicker_player_name %in% c("J.Bates", "J.Tucker", "C.Boswell", "C.Dicker", "B.Aubrey", "C.McLaughlin", "J.Elliott", "T.Bass", "J.Sanders", "H.Butker", "T.Loop", "K.Fairbairn", "C.Santos", "J.Karty", "M.Gay", "W.Lutz", "E.McPherson", "D.Carlson", "B.McManus", "J.Myers", "W.Reichard", "Y.Koo", "Z.Gonzalez", "J.Moody", "C.Little", "A.Borregales", "C.Ryland", "G.Gano", "D.Hopkins", "M.Wright", "S.Shrader", "B.Grupe", "J.Slye", "J.McAtamney", "J.Parker Romo", "C.Davis", "A.Carlson", "G.Zuerlein", "N.Folk", "G.Joseph", "E.Pineiro", "A.Seibert", "M.Prater", "B.Narveson", "L.Havrisik", "C.York", "T.Brown", "C.Dunn", "R.Bullock", "B.Maher", "M.Ammendola", "N.Sciba", "J.Garibay", "R.Patterson", "J. McCourt", "C.Shudak", "M.Badgley"))%>%
  group_by(kicker_player_name)%>%
  summarise(windy_attempts = n(),
            windy_makes = sum(result),
            windy_percentage = windy_makes / windy_attempts,
            windy_total_above_exp = sum(makes_above_expected),
            windy_avg_above_exp = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(windy_avg_above_exp))%>%
  mutate(windy_current_rank = row_number())

head(windy_kicks_current, 10)
```

best cold current kickers:
```{r}
cold_kicks_current = ranked_kickers%>%
  filter(temp <= 40,
         kicker_player_name %in% c("J.Bates", "J.Tucker", "C.Boswell", "C.Dicker", "B.Aubrey", "C.McLaughlin", "J.Elliott", "T.Bass", "J.Sanders", "H.Butker", "T.Loop", "K.Fairbairn", "C.Santos", "J.Karty", "M.Gay", "W.Lutz", "E.McPherson", "D.Carlson", "B.McManus", "J.Myers", "W.Reichard", "Y.Koo", "Z.Gonzalez", "J.Moody", "C.Little", "A.Borregales", "C.Ryland", "G.Gano", "D.Hopkins", "M.Wright", "S.Shrader", "B.Grupe", "J.Slye", "J.McAtamney", "J.Parker Romo", "C.Davis", "A.Carlson", "G.Zuerlein", "N.Folk", "G.Joseph", "E.Pineiro", "A.Seibert", "M.Prater", "B.Narveson", "L.Havrisik", "C.York", "T.Brown", "C.Dunn", "R.Bullock", "B.Maher", "M.Ammendola", "N.Sciba", "J.Garibay", "R.Patterson", "J. McCourt", "C.Shudak", "M.Badgley"))%>%
  group_by(kicker_player_name)%>%
  summarise(cold_attempts = n(),
            cold_makes = sum(result),
            cold_percentage = cold_makes / cold_attempts,
            cold_total_above_exp = sum(makes_above_expected),
            cold_avg_above_exp = mean(makes_above_expected),
            .groups = 'drop')%>%
  arrange(desc(cold_avg_above_exp))%>%
  mutate(cold_current_rank = row_number())

head(cold_kicks_current, 10)
```

## EPA/WPA produced analysis
Now I want to see kickers in terms of how the produce EPA/WPA

Historical EPA
```{r}
epa_kickers = ranked_kickers%>%
  group_by(kicker_player_name)%>%
  summarise(kick_attempts = n(),
            total_epa = sum(epa),
            epa_per_attempt = total_epa / kick_attempts,
            .groups = 'drop')%>%
  arrange(desc(epa_per_attempt))

head(epa_kickers, 10)
```

Historically, Justin Tucker has generated the most total epa, and ranks top 8 all time in epa per attempt (4th among those with 50+ attemtps)

Historical WPA
```{r}
wpa_kickers = ranked_kickers%>%
  group_by(kicker_player_name)%>%
  summarise(kick_attempts = n(),
            total_wpa = sum(wpa),
            wpa_per_attempt = total_wpa / kick_attempts,
            .groups = 'drop')%>%
  arrange(desc(wpa_per_attempt))%>%
  filter(kick_attempts >= 50) ##again you cna manipulate this threshold

head(wpa_kickers, 10)
```

Justin Tucker has also generated the most total WPA historically and is 10th all time in wpa per attempt for kickers with at least 50 attempts (jake Bates isn #1 already)

Current players EPA:
```{r}
epa_kickers_current = ranked_kickers%>%
  group_by(kicker_player_name)%>%
  summarise(kick_attempts = n(),
            total_epa = sum(epa),
            epa_per_attempt = total_epa / kick_attempts,
            .groups = 'drop')%>%
  arrange(desc(epa_per_attempt))%>%
  filter(kicker_player_name %in% c("J.Bates", "J.Tucker", "C.Boswell", "C.Dicker", "B.Aubrey", "C.McLaughlin", "J.Elliott", "T.Bass", "J.Sanders", "H.Butker", "T.Loop", "K.Fairbairn", "C.Santos", "J.Karty", "M.Gay", "W.Lutz", "E.McPherson", "D.Carlson", "B.McManus", "J.Myers", "W.Reichard", "Y.Koo", "Z.Gonzalez", "J.Moody", "C.Little", "A.Borregales", "C.Ryland", "G.Gano", "D.Hopkins", "M.Wright", "S.Shrader", "B.Grupe", "J.Slye", "J.McAtamney", "J.Parker Romo", "C.Davis", "A.Carlson", "G.Zuerlein", "N.Folk", "G.Joseph", "E.Pineiro", "A.Seibert", "M.Prater", "B.Narveson", "L.Havrisik", "C.York", "T.Brown", "C.Dunn", "R.Bullock", "B.Maher", "M.Ammendola", "N.Sciba", "J.Garibay", "R.Patterson", "J. McCourt", "C.Shudak", "M.Badgley"))%>%
  mutate(epa_per_current_rank = row_number())

head(epa_kickers_current, 10)
```

Among active players in the league, Again Justin Tucker is the best in raw EPA, but there's quite a few notable kickers:

current EPA PLOT
```{r}
mean_avg_epa = mean(epa_kickers_current$total_epa)


EPA_current_kickers_plot = ggplot(epa_kickers_current, 
  mapping = aes(x = kicker_player_name, 
  y = total_epa,
  size = kick_attempts))+
  geom_point()+
  geom_hline(yintercept = mean_avg_epa, 
             linetype = "dashed", color = "red")+
  dark_theme_minimal()+
  theme(axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    panel.grid = element_blank())+
  geom_text_repel(aes(label = kicker_player_name), 
                  nudge_y = -0.005,
                  direction = "y",
                  segment.size = 0.2, 
                  size = 3)+
  labs(title = "Total EPA generated", 
       subtitle = "current NFL kickers",
       x = "Player",
       y = "EPA")

EPA_current_kickers_plot
```

Current kickers EPA per attempt:
```{r}
mean_avg_epa_per_attempt = mean(epa_kickers_current$epa_per_attempt)


EPA_per_current_kickers_plot = ggplot(epa_kickers_current, 
  mapping = aes(x = kicker_player_name, 
  y = epa_per_attempt,
  size = kick_attempts))+
  geom_point()+
  geom_hline(yintercept = mean_avg_epa_per_attempt, 
             linetype = "dashed", color = "red")+
  dark_theme_minimal()+
  theme(axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    panel.grid = element_blank())+
  geom_text_repel(aes(label = kicker_player_name), 
                  nudge_y = -0.005,
                  direction = "y",
                  segment.size = 0.2, 
                  size = 3)+
  labs(title = "EPA-Per Attempt", 
       subtitle = "by current NFL kickers",
       x = "Player",
       y = "EPA-PA")

EPA_per_current_kickers_plot
```

WPA Current Players
```{r}
wpa_kickers_current = ranked_kickers%>%
  group_by(kicker_player_name)%>%
  summarise(kick_attempts = n(),
            total_wpa = sum(wpa),
            wpa_per_attempt = total_wpa / kick_attempts,
            .groups = 'drop')%>%
  arrange(desc(wpa_per_attempt))%>%
  filter(kicker_player_name %in% c("J.Bates", "J.Tucker", "C.Boswell", "C.Dicker", "B.Aubrey", "C.McLaughlin", "J.Elliott", "T.Bass", "J.Sanders", "H.Butker", "T.Loop", "K.Fairbairn", "C.Santos", "J.Karty", "M.Gay", "W.Lutz", "E.McPherson", "D.Carlson", "B.McManus", "J.Myers", "W.Reichard", "Y.Koo", "Z.Gonzalez", "J.Moody", "C.Little", "A.Borregales", "C.Ryland", "G.Gano", "D.Hopkins", "M.Wright", "S.Shrader", "B.Grupe", "J.Slye", "J.McAtamney", "J.Parker Romo", "C.Davis", "A.Carlson", "G.Zuerlein", "N.Folk", "G.Joseph", "E.Pineiro", "A.Seibert", "M.Prater", "B.Narveson", "L.Havrisik", "C.York", "T.Brown", "C.Dunn", "R.Bullock", "B.Maher", "M.Ammendola", "N.Sciba", "J.Garibay", "R.Patterson", "J. McCourt", "C.Shudak", "M.Badgley"))%>%
  mutate(wpa_per_current_rank = row_number())

head(wpa_kickers_current, 10)
```

Among current NFL kickers Tucker leads again in raw WPA generated, and is top 6 in wpa per attempt but note how jake bates, wright, little, and dicker are already off to strong starts with 50+ reps.

Total WPA current players
```{r}
mean_avg_wpa = mean(wpa_kickers_current$total_wpa)


WPA_current_kickers_plot = ggplot(wpa_kickers_current, 
  mapping = aes(x = kicker_player_name, 
  y = total_wpa,
  size = kick_attempts))+
  geom_point()+
  geom_hline(yintercept = mean_avg_wpa, 
             linetype = "dashed", color = "red")+
  dark_theme_minimal()+
  theme(axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    panel.grid = element_blank())+
  geom_text_repel(aes(label = kicker_player_name), 
                  nudge_y = -0.005,
                  direction = "y",
                  segment.size = 0.2, 
                  size = 3)+
  labs(title = "Total WPA Generated", 
       subtitle = "by current NFL kickers",
       x = "Player",
       y = "WPA")

WPA_current_kickers_plot
```

WPA per attempt current players
```{r}
mean_avg_wpa_per_attempt = mean(wpa_kickers_current$wpa_per_attempt)


WPA_per_current_kickers_plot = ggplot(wpa_kickers_current, 
  mapping = aes(x = kicker_player_name, 
  y = wpa_per_attempt,
  size = kick_attempts))+
  geom_point()+
  geom_hline(yintercept = mean_avg_wpa_per_attempt, 
             linetype = "dashed", color = "red")+
  dark_theme_minimal()+
  theme(axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    panel.grid = element_blank())+
  geom_text_repel(aes(label = kicker_player_name), 
                  nudge_y = -0.005,
                  direction = "y",
                  segment.size = 0.2, 
                  size = 3)+
  labs(title = "WPA-Per Attempt", 
       subtitle = "by current NFL kickers",
       x = "Player",
       y = "WPA-PA")

WPA_per_current_kickers_plot
```

##Final Ranking of Current Kickers
Now to answer the final question of how we are going to determine a list, one singular list of where each current kicker stands. I'm going to take each kicker's ranking:

-average kicks made above expected

-average FG's made above expected

-average KoE for "long" 50+ situations

-average KoE for "clutch" situations

-average KoE for "windy" attempts

-average KoE for "cold" attempts

-EPA per attempt

WPA per attempt 

and compile them into one set ranked list. All will be weighted equally for now.


Compiling one big ranking
```{r}
final_ranked_current_kickers = ranked_kickers_average_current%>%
  dplyr::select(kicker_player_name, AMoE_current_rank)%>%
  
  left_join(ranked_kickers_fg_current_avg%>%
              dplyr::select(kicker_player_name, AMoE_FG_current_rank),
            by = "kicker_player_name")%>%
  
  left_join(ranked_kickers_long_current_avg%>%
              dplyr::select(kicker_player_name, long_current_rank),
            by = "kicker_player_name")%>%
  
  left_join(clutch_kicker_current%>%
              dplyr::select(kicker_player_name, clutch_current_rank),
            by = "kicker_player_name")%>%
  
  left_join(windy_kicks_current%>%
              dplyr::select(kicker_player_name, windy_current_rank),
            by = "kicker_player_name")%>%
  
  left_join(cold_kicks_current%>%
              dplyr::select(kicker_player_name, cold_current_rank),
            by = "kicker_player_name")%>%
  
  left_join(epa_kickers_current%>%
              dplyr::select(kicker_player_name, epa_per_current_rank),
            by = "kicker_player_name")%>%
  
  left_join(wpa_kickers_current%>%
              dplyr::select(kicker_player_name, wpa_per_current_rank),
            by = "kicker_player_name")%>%
  
  mutate(final_composite_score = (AMoE_current_rank + 
                       AMoE_FG_current_rank +
                       long_current_rank +
                       clutch_current_rank +
                       windy_current_rank +
                       cold_current_rank +
                       epa_per_current_rank +
                       wpa_per_current_rank) / 8)%>%
  
  arrange(final_composite_score)%>%
  mutate(Final_Rank = row_number())%>%
  
  dplyr::select(kicker_player_name, 
                Final_Rank,
                final_composite_score,
                AMoE_current_rank, 
                AMoE_FG_current_rank,
                long_current_rank,
                clutch_current_rank,
                windy_current_rank,
                cold_current_rank,
                epa_per_current_rank,
                wpa_per_current_rank)

final_ranked_current_kickers

```







